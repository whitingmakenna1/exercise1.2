<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MEDI-610 Project — EX05</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-latest.min.js"></script>

  <style>
    /* Clean, student-appropriate styling */
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.08);
    }

    h1 {
      margin-top: 0;
      color: #2d3e50;
    }

    fieldset {
      border: 1px solid #d0d7e2;
      padding: 20px;
      border-radius: 8px;
    }

    legend {
      font-weight: bold;
      color: #3b4b63;
    }

    label {
      display: inline-block;
      width: 160px;
      margin-bottom: 8px;
    }

    select, input[type="text"] {
      padding: 8px;
      width: 220px;
      border-radius: 5px;
      border: 1px solid #c4ccda;
    }

    .buttons {
      margin-left: 160px;
      margin-top: 15px;
    }

    #btnSearch {
      background: #6881a2;
      color: white;
      padding: 10px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 10px;
    }

    input[type="reset"] {
      background: #e3eaf4;
      color: #4c6280;
      padding: 10px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #results {
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>MEDI610 – EX05</h1>

    <form>
      <fieldset>
        <legend>Search Criteria</legend>

        <p>
          <label for="orgType">Organization Type</label>
          <select id="orgType" name="type">
            <option>Loading...</option>
          </select>
        </p>

        <p>
          <label for="orgName">Organization Name</label>
          <input id="orgName" name="name" type="text">
          <em style="color:#6881a2; font-size:12px;">*partial allowed</em>
        </p>

        <p>
          <label for="state">State</label>
          <select id="state" name="state" onchange="getCities(this.value)">
            <option value="">All States</option>
            <option value="AK">AK</option><option value="AL">AL</option>
            <option value="AR">AR</option><option value="AZ">AZ</option>
            <option value="CA">CA</option><option value="CO">CO</option>
            <option value="CT">CT</option><option value="DC">DC</option>
            <option value="DE">DE</option><option value="FL">FL</option>
            <option value="GA">GA</option><option value="HI">HI</option>
            <option value="IA">IA</option><option value="ID">ID</option>
            <option value="IL">IL</option><option value="IN">IN</option>
            <option value="KS">KS</option><option value="KY">KY</option>
            <option value="LA">LA</option><option value="MA">MA</option>
            <option value="MD">MD</option><option value="ME">ME</option>
            <option value="MI">MI</option><option value="MN">MN</option>
            <option value="MO">MO</option><option value="MS">MS</option>
            <option value="MT">MT</option><option value="NC">NC</option>
            <option value="ND">ND</option><option value="NE">NE</option>
            <option value="NH">NH</option><option value="NJ">NJ</option>
            <option value="NM">NM</option><option value="NV">NV</option>
            <option value="NY" selected>NY</option><option value="OH">OH</option>
            <option value="OK">OK</option><option value="OR">OR</option>
            <option value="PA">PA</option><option value="RI">RI</option>
            <option value="SC">SC</option><option value="SD">SD</option>
            <option value="TN">TN</option><option value="TX">TX</option>
            <option value="UT">UT</option><option value="VA">VA</option>
            <option value="VT">VT</option><option value="WA">WA</option>
            <option value="WI">WI</option><option value="WV">WV</option>
            <option value="WY">WY</option>
          </select>

          <select id="citySearch" name="town">
            <option value="">--Select a Town in NY--</option>
          </select>
        </p>

        <p>
          <label for="county">County</label>
          <input id="county" name="county" type="text">
        </p>

        <p>
          <label for="zip">ZIP Code</label>
          <input id="zip" name="zip" type="text">
        </p>

        <div class="buttons">
          <input id="btnSearch" value="Show Results" type="button">
          <input type="reset" value="Reset Form">
        </div>
      </fieldset>
    </form>

    <div id="results"></div>
  </div>

  <script>
    /* IMPORTANT: Using correct relative paths for Banjo */
    const STATES_XML = "USA_states_counties_cities_vf.xml";
    const ORGS_XML   = "organizations.xml";

    $(document).ready(function () {
      getOrgTypes();
      getCities("NY"); // load NY on page open
    });

    function getOrgTypes() {
      $.get(ORGS_XML, function (data) {
        const $org = $("#orgType");
        $org.empty();
        $org.append("<option value=''>-- Select Organization Type --</option>");

        $(data)
          .find("row")
          .each(function () {
            const id = $(this).find("typeId").text();
            const t = $(this).find("type").text();
            $org.append(`<option value="${id}">${t}</option>`);
          });
      });
    }

    function getCities(state) {
      const $city = $("#citySearch");
      $city.empty();

      if (!state) {
        $city.append("<option>--Select a State--</option>");
        $city.prop("disabled", true);
        return;
      }

      $.get(STATES_XML, function (data) {
        const matches = $(data)
          .find("item")
          .filter(function () {
            return (
              $(this).find("stateShort").text().trim().toUpperCase() ===
              state.toUpperCase()
            );
          });

        if (matches.length === 0) {
          $city.append(`<option>No cities/towns in "${state}"</option>`);
          $city.prop("disabled", true);
          return;
        }

        $city.append(`<option value="">--Select a Town in ${state}--</option>`);
        $city.prop("disabled", false);

        const townSet = new Set();
        matches.each(function () {
          const town = $(this).find("city").text().trim();
          if (town) townSet.add(town);
        });

        Array.from(townSet)
          .sort()
          .forEach((t) => {
            $city.append(`<option value="${t}">${t}</option>`);
          });
      });
    }
  </script>
</body>
</html>